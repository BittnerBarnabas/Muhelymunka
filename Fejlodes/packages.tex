\usepackage[utf8]{inputenc}
\usepackage{listings}
\usepackage{color}
\usepackage[pdftex]{graphicx}
\usepackage{setspace}
\usepackage[nottoc, numbib]{tocbibind}
\usepackage[
	a4paper,
	top=2.5cm,
	bottom=2.5cm,
	inner=3.5cm,
	outer=2.5cm
]{geometry}
\usepackage{times}
\usepackage[document]{ragged2e}
\usepackage{hyperref}
\linespread{1.5}
\usepackage{float}
\usepackage{listings}
\usepackage{textcomp}
\usepackage{subfiles}
\usepackage{xcolor}
\usepackage{titlesec}
\setcounter{secnumdepth}{4}

\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhf{}
\fancyhead[L]{\rightmark }
\fancyhead[R]{\thepage}
\usepackage{spverbatim}
\usepackage[magyar]{babel}
\usepackage[backend = biber, backref = true, style=apa, maxcitenames=2]{biblatex}
\usepackage{hyperref}

%%START- This is needed to replace ampersands with and 
\DeclareDelimFormat*{finalnamedelim}
{\ifnum\value{liststop}>2 \finalandcomma\fi\addspace\bibstring{and}\space}

% the bibliography also needs another conditional, so we can't wrap
% everything up with just the two lines above
\DeclareDelimFormat[bib,biblist]{finalnamedelim}{%
	\ifthenelse{\value{listcount}>\maxprtauth}
	{}
	{\ifthenelse{\value{liststop}>2}
		{\finalandcomma\addspace\bibstring{and}\space}
		{\addspace\bibstring{and}\space}}}

% this is a special delimiter to solve the bugs reported in
% https://tex.stackexchange.com/q/417648/35864
\DeclareDelimFormat*{finalnamedelim:apa:family-given}{%
	\ifthenelse{\value{listcount}>\maxprtauth}
	{}
	{\finalandcomma\addspace\bibstring{and}\space}}
%%END - This is needed to replace ampersands with and 

\DefineBibliographyStrings{english}{%
		bibliography     = {Irodalomjegyz\'ek},
		references       = {Hivatkoz\'asok},
		shorthands       = {R\"ovid\'it\'esek jegyz\'eke},
		editor           = {szerkeszt\H{o}},
		editors          = {szerkeszt\H{o}k},
		compiler         = {\"ossze\'all\'it\'o},
		compilers        = {\"ossze\'all\'it\'ok},
		redactor         = {sajt\'o al\'a rendez\H{o}},
		redactors        = {sajt\'o al\'a rendez\H{o}k},
		reviser          = {korrektor},
		revisers         = {korrektorok},
		founder          = {alap\'it\'o},
		founders         = {alap\'it\'ok},
		%continuator      = {},
		%continuators     = {},% FIXME missing
		collaborator     = {k\"ozrem\H{u}k\"od\H{o}},
		collaborators    = {k\"ozrem\H{u}k\"od\H{o}k},
		translator       = {ford\'it\'o},
		translators      = {ford\'it\'ok},
		commentator      = {komment\'ator},
		commentators     = {komment\'atorok},
		annotator        = {jegyzetek \'ir\'oja},
		annotators       = {jegyzetek \'ir\'oi},
		commentary       = {komment\'ar},
		annotations      = {jegyzetek},
		introduction     = {bevezet\'es},
		foreword         = {el\H{o}sz\'o},
		afterword        = {ut\'osz\'o},
		editortr         = {szerkeszt\H{o} \'es ford\'it\'o},
		editorstr        = {szerkeszt\H{o}k \'es ford\'it\'ok},,
		editorco         = {szerkeszt\H{o} \'es komment\'ar},
		editorsco        = {szerkeszt\H{o} \'es komment\'ar},
		editoran         = {szerkeszt\H{o} \'es jegyzet},
		editorsan        = {szerkeszt\H{o} \'es jegyzet},
		editorin         = {szerkeszt\H{o} \'es bevezet\H{o}},
		editorsin        = {szerkeszt\H{o}k \'es bevezet\H{o}},
		editorfo         = {szerkeszt\H{o} \'es el\H{o}sz\'o},
		editorsfo        = {szerkeszt\H{o}k \'es el\H{o}sz\'o},
		editoraf         = {szerkeszt\H{o} \'es ut\'osz\'o}
		editorsaf        = {szerkeszt\H{o}k \'es ut\'osz\'o},
		editortrco       = {szerkeszt\H{o}, ford\'it\'o \'es komment\'ar},
		editorstrco      = {szerkeszt\H{o}, ford\'it\'o \'es komment\'ar},
		editortran       = {szerkeszt\H{o}, ford\'it\'o \'es jegyzet},
		editorstran      = {szerkeszt\H{o}, ford\'it\'o \'es jegyzet},
		editortrin       = {szerkeszt\H{o}, ford\'it\'o \'es bevezet\H{o}},
		editorstrin      = {szerkeszt\H{o}, ford\'it\'o \'es bevezet\H{o}},
		editortrfo       = {szerkeszt\H{o}, ford\'it\'o \'es el\H{o}sz\'o},
		editorstrfo      = {szerkeszt\H{o}, ford\'it\'o \'es el\H{o}sz\'o},
		editortraf       = {szerkeszt\H{o}, ford\'it\'o \'es ut\'osz\'o},
		editorstraf      = {szerkeszt\H{o}, ford\'it\'o \'es ut\'osz\'o},
		editorcoin       = {szerkeszt\H{o}, komment\'ar \'es bevezet\H{o}},
		editorscoin      = {szerkeszt\H{o}, komment\'ar \'es bevezet\H{o}},
		editorcofo       = {szerkeszt\H{o}, komment\'ar \'es el\H{o}sz\'o},
		editorscofo      = {szerkeszt\H{o}, komment\'ar \'es el\H{o}sz\'o},
		editorcoaf       = {szerkeszt\H{o}, komment\'ar \'es ut\'osz\'o},
		editorscoaf      = {szerkeszt\H{o}, komment\'ar \'es ut\'osz\'o},
		editoranin       = {szerkeszt\H{o}, jegyzetek \'es bevezet\H{o}},
		editorsanin      = {szerkeszt\H{o}, jegyzetek \'es bevezet\H{o}},
		editoranfo       = {szerkeszt\H{o}, jegyzetek \'es el\H{o}sz\'o},
		editorsanfo      = {szerkeszt\H{o}, jegyzetek \'es el\H{o}sz\'o},
		editoranaf       = {szerkeszt\H{o}, jegyzetek \'es ut\'osz\'o},
		editorsanaf      = {szerkeszt\H{o}, jegyzetek \'es ut\'osz\'o},
		editortrcoin     = {szerkeszt\H{o}, ford\'it\'o, komment\'ar \'es bevezet\H{o}},
		editorstrcoin    = {szerkeszt\H{o}, ford\'it\'o, komment\'ar \'es bevezet\H{o}},
		editortrcofo     = {szerkeszt\H{o}, ford\'it\'o, komment\'ar \'es el\H{o}sz\'o},
		editorstrcofo    = {szerkeszt\H{o}, ford\'it\'o, komment\'ar \'es el\H{o}sz\'o},
		editortrcoaf     = {szerkeszt\H{o}, ford\'it\'o, komment\'ar \'es ut\'osz\'o},
		editorstrcoaf    = {szerkeszt\H{o}, ford\'it\'o, komment\'ar \'es ut\'osz\'o},
		editortranin     = {szerkeszt\H{o}, ford\'it\'o, jegyzetek \'es bevezet\H{o}},
		editorstranin    = {szerkeszt\H{o}, ford\'it\'o, jegyzetek \'es bevezet\H{o}},
		editortranfo     = {szerkeszt\H{o}, ford\'it\'o, jegyzetek \'es el\H{o}sz\'o},
		editorstranfo    = {szerkeszt\H{o}, ford\'it\'o, jegyzetek \'es el\H{o}sz\'o},
		editortranaf     = {szerkeszt\H{o}, ford\'it\'o, jegyzetek \'es ut\'osz\'o},
		editorstranaf    = {szerkeszt\H{o}, ford\'it\'o, jegyzetek \'es ut\'osz\'o},
		translatorco     = {ford\'it\'o \'es komment\'ar},
		translatorsco    = {ford\'it\'o \'es komment\'ar},
		translatoran     = {ford\'it\'o \'es jegyzetek},
		translatorsan    = {ford\'it\'o \'es jegyzetek},
		translatorin     = {ford\'it\'o \'es bevezet\H{o}},
		translatorsin    = {ford\'it\'o \'es bevezet\H{o}},
		translatorfo     = {ford\'it\'o \'es el\H{o}sz\'o},
		translatorsfo    = {ford\'it\'o \'es el\H{o}sz\'o},
		translatoraf     = {ford\'it\'o \'es ut\'osz\'o},
		translatorsaf    = {ford\'it\'o \'es ut\'osz\'o},
		translatorcoin   = {ford\'it\'o, komment\'ar \'es bevezet\H{o}},
		translatorscoin  = {ford\'it\'o, komment\'ar \'es bevezet\H{o}},
		translatorcofo   = {ford\'it\'o, komment\'ar \'es el\H{o}sz\'o},
		translatorscofo  = {ford\'it\'o, komment\'ar \'es el\H{o}sz\'o},
		translatorcoaf   = {ford\'it\'o, komment\'ar \'es ut\'osz\'o},
		translatorscoaf  = {ford\'it\'o, komment\'ar \'es ut\'osz\'o},
		translatoranin   = {ford\'it\'o, jegyzetek \'es bevezet\H{o}},
		translatorsanin  = {ford\'it\'o, jegyzetek \'es bevezet\H{o}},
		translatoranfo   = {ford\'it\'o, jegyzetek \'es el\H{o}sz\'o},
		translatorsanfo  = {ford\'it\'o, jegyzetek \'es el\H{o}sz\'o},
		translatoranaf   = {ford\'it\'o, jegyzetek \'es ut\'osz\'o},
		translatorsanaf  = {ford\'it\'o, jegyzetek \'es ut\'osz\'o},
		organizer        = {szervez\H{o}},
		organizers       = {szervez\H{o}k},
		byorganizer      = {szervezte},
		byauthor         = {\'irta},
		byeditor         = {szerkesztette},
		bycompiler       = {\"ossze\'all\'itotta},
		byredactor       = {sajt\'o al\'a rendezte},
		byreviser        = {jav\'itotta},
		byreviewer       = {b\'ir\'alta},
		byfounder        = {alap\'itotta},
		% bycontinuator    = {},% FIXME missing
		bycollaborator   = {k\"ozrem\H{u}k\"od\"ott},
		bytranslator     = {\lbx@lfromlang ford\'itotta},
		bycommentator    = {komment\'alta},
		byannotator      = {jegyzetekkel ell\'atta},
		withcommentator  = {komment\'arral ell\'atta},
		withannotator    = {jegyzetekkel ell\'atta},
		withintroduction = {bevezet\H{o}vel ell\'atta},
		withforeword     = {el\H{o}sz\'oval ell\'atta},
		withafterword    = {ut\'osz\'oval ell\'atta},
		byeditortr       = {szerkesztette \'es \lbx@lfromlang ford\'itotta},
		byeditorco       = {szerkesztette \'es komment\'alta},
		byeditoran       = {szerkesztette \'es jegyzetekkel ell\'atta},
		byeditorin       = {szerkesztette \'es bevezet\H{o}vel ell\'atta},
		byeditorfo       = {szerkesztette \'es el\H{o}sz\'oval ell\'atta},
		byeditoraf       = {szerkesztette \'es ut\'osz\'oval ell\'atta},
		byeditortrco     = {szerkesztette, \lbx@lfromlang ford\'itotta \'es komment\'alta},
		byeditortran     = {szerkesztette, \lbx@lfromlang ford\'itotta \'es jegyzetekkel ell\'atta},
		byeditortrin     = {szerkesztette, \lbx@lfromlang ford\'itotta \'es bevezet\H{o}vel ell\'atta},
		byeditortrfo     = {szerkesztette, \lbx@lfromlang ford\'itotta \'es el\H{o}sz\'oval ell\'atta},
		byeditortraf     = {szerkesztette, \lbx@lfromlang ford\'itotta \'es ut\'osz\'oval ell\'atta},
		byeditorcoin     = {szerkesztette, komment\'alta \'es bevezet\H{o}vel ell\'atta},
		byeditorcofo     = {szerkesztette, komment\'alta \'es el\H{o}sz\'oval ell\'atta},
		byeditorcoaf     = {szerkesztette, komment\'alta \'es ut\'osz\'oval ell\'atta},
		byeditoranin     = {szerkesztette, jegyzetekkel \'es bevezet\H{o}vel ell\'atta},
		byeditoranfo     = {szerkesztette, jegyzetekkel \'es el\H{o}sz\'oval ell\'atta},
		byeditoranaf     = {szerkesztette, jegyzetekkel \'es ut\'osz\'oval ell\'atta},
		byeditortrcoin   = {szerkesztette, \lbx@lfromlang ford\'itotta, komment\'alta \'es bevezet\H{o}vel ell\'atta},
		byeditortrcofo   = {szerkesztette, \lbx@lfromlang ford\'itotta, komment\'alta \'es el\H{o}sz\'oval ell\'atta},
		byeditortrcoaf   = {szerkesztette, \lbx@lfromlang ford\'itotta, komment\'alta \'es ut\'osz\'oval ell\'atta},
		byeditortranin   = {szerkesztette, \lbx@lfromlang ford\'itotta, jegyzetekkel \'es bevezet\H{o}vel ell\'atta},
		byeditortranfo   = {szerkesztette, \lbx@lfromlang ford\'itotta, jegyzetekkel \'es el\H{o}sz\'oval ell\'atta},
		byeditortranaf   = {szerkesztette, \lbx@lfromlang ford\'itotta, jegyzetekkel \'es ut\'osz\'oval ell\'atta},
		bytranslatorco   = {\lbx@lfromlang ford\'itotta \'es komment\'alta},
		bytranslatoran   = {\lbx@lfromlang ford\'itotta \'es jegyzetekkel ell\'atta},
		bytranslatorin   = {\lbx@lfromlang ford\'itotta \'es bevezet\H{o}vel ell\'atta},
		bytranslatorfo   = {\lbx@lfromlang ford\'itotta \'es el\H{o}sz\'oval ell\'atta},
		bytranslatoraf   = {\lbx@lfromlang ford\'itotta \'es ut\'osz\'oval ell\'atta},
		bytranslatorcoin = {\lbx@lfromlang ford\'itotta, komment\'alta \'es bevezet\H{o}vel ell\'atta},
		bytranslatorcofo = {\lbx@lfromlang ford\'itotta, komment\'alta \'es el\H{o}sz\'oval ell\'atta},
		bytranslatorcoaf = {\lbx@lfromlang ford\'itotta, komment\'alta \'es ut\'osz\'oval ell\'atta},
		bytranslatoranin = {\lbx@lfromlang ford\'itotta, jegyzetekkel \'es bevezet\H{o}vel ell\'atta},
		bytranslatoranfo = {\lbx@lfromlang ford\'itotta, jegyzetekkel \'es el\H{o}sz\'oval ell\'atta},
		bytranslatoranaf = {\lbx@lfromlang ford\'itotta, jegyzetekkel \'es ut\'osz\'oval ell\'atta},
		and              = {\'es},
		andothers        = {\'es mtsai\addot},
		andmore          = {et\addabbrvspace al\adddot},
		volume           = {k\"otet},
		volumes          = {k\"otetek},
		involumes        = {},
		jourvol          = {\'evfolyam},
		jourser          = {sorozat},
		book             = {k\"onyv},
		part             = {r\'esz},
		issue            = {sz\'am},
		newseries        = {\'uj sorozat},
		oldseries        = {r\'egi sorozat},
		edition          = {kiad\'as},
		reprint          = {ut\'annyom\'as},
		reprintof        = {ut\'annyom\'asa},% FIXME swap word order
		reprintas        = {ut\'annyom\'as c\'ime},
		% reprintfrom      = {},% FIXME need example
		translationof    = {ford\'it\'asa},% FIXME swap word order
		translationas    = {ford\'it\'as c\'ime},
		% translationfrom  = {},% FIXME need example
		reviewof         = {recenzi\'oja},% FIXME swap word order
		origpubas        = {eredeti c\'ime},
		origpubin        = {eredeti kiad\'as},
		% astitle          = {},% FIXME need example
		% bypublisher      = {\addcomma},% FIXME: this is a cludge that can not be guaranteed to work in most situations, so it stays commented out
		nodate           = {\'ev n\'elk\"ul},
		page             = {oldal},
		pages            = {oldal},
		column           = {has\'ab},
		columns          = {has\'ab},
		line             = {sor},
		lines            = {sor},
		verse            = {versszak},
		verses           = {versszak},
		section          = {paragrafus},
		sections         = {paragrafus},
		paragraph        = {bekezd\'es},
		paragraphs       = {bekezd\'es},
		pagetotal        = {oldal},
		pagetotals       = {oldal},
		columntotal      = {has\'ab},
		columntotals     = {has\'ab},
		linetotal        = {sor},
		linetotals       = {sor},
		versetotal       = {versszak},
		versetotals      = {versszak},
		sectiontotal     = {paragrafus},
		sectiontotals    = {paragrafus},
		paragraphtotal   = {bekezd\'es},
		paragraphtotals  = {bekezd\'es},
		in               = {},
		% inseries         = {},% FIXME need example
		% ofseries         = {},% FIXME need example
		number           = {sz\'am},
		chapter          = {fejezet},
		bathesis         = {szakdolgozat},
		mathesis         = {diplomaterv},
		phdthesis        = {disszert\'aci\'o},
		candthesis       = {disszert\'aci\'o},
		resreport        = {kutat\'asi jelent\'es},
		techreport       = {technikai jelent\'es},
		software         = {szoftver},
		datacd           = {CD-ROM},
		audiocd          = {audio CD},
		version          = {verzi\'o},
		url              = {c\'im},
		urlfrom          = {el\'erhet\H{o}},
		urlseen          = {el\'er\'es d\'atuma},
		inpreparation    = {el\H{o}k\'esz\'it\'es alatt},
		submitted        = {bek\"uld\"ott},
		forthcoming      = {elfogadott},
		inpress          = {nyomd\'aban},
		prepublished     = {preprint},
		citedas          = {tov\'abbiakban},
		thiscite         = {itt},
		seenote          = {l\'asd},
		quotedin         = {id\'ezte},
		idem             = {ugyan\H{o}},
		idemsf           = {ugyan\H{o}},
		idemsm           = {ugyan\H{o}},
		idemsn           = {ugyan\H{o}},
		idempf           = {ugyan\H{o}k},
		idempm           = {ugyan\H{o}k},
		idempn           = {ugyan\H{o}k},
		idempp           = {ugyan\H{o}k},
		ibidem           = {ugyanitt},
		opcit            = {id\'ezett m\H{u}},
		loccit           = {id\'ezett hely},
		confer           = {v\"o\adddot},
		sequens          = {sk\adddot},
		sequentes        = {skk\adddot},
		passim           = {passim},
		see              = {l\'asd},
		seealso          = {l\'asd m\'eg},
		backrefpage      = {hivatkoz\'asi oldal},
		backrefpages     = {hivatkoz\'asi oldalak},
		january          = {janu\'ar},
		february         = {febru\'ar},
		march            = {m\'arcius},
		april            = {\'aprilis},
		may              = {m\'ajus},
		june             = {j\'unius},
		july             = {j\'ulius},
		august           = {augusztus},
		september        = {szeptember},
		october          = {okt\'ober},
		november         = {november},
		december         = {december},
		langamerican     = {angol},
		langbrazilian    = {brazil},
		langbulgarian    = {bolg\'ar},
		langcatalan      = {katal\'an},
		langcroatian     = {horv\'at},
		langczech        = {cseh},
		langdanish       = {d\'an},
		langdutch        = {holland},
		langenglish      = {angol},
		langestonian     = {\'eszt},
		langfinnish      = {finn},
		langfrench       = {francia},
		langgalician     = {gal\'iciai},
		langgerman       = {n\'emet},
		langgreek        = {g\"or\"og},
		langitalian      = {olasz},
		langjapanese     = {jap\'an},
		langlatin        = {latin},
		langlatvian      = {lett},
		langnorwegian    = {norv\'eg},
		langpolish       = {lengyel},
		langportuguese   = {portug\'al},
		langrussian      = {orosz},
		langslovak       = {szlov\'ak},
		langslovene      = {szlov\'en},
		langspanish      = {spanyol},
		langswedish      = {sv\'ed},
		langukrainian    = {ukr\'an},
		fromamerican     = {angolb\'ol},
		frombrazilian    = {brazilb\'ol},
		frombulgarian    = {brazilb\'ol},
		fromcatalan      = {katal\'anb\'ol},
		fromcroatian     = {horv\'atb\'ol},
		fromczech        = {csehb\H{o}l},
		fromdanish       = {d\'anb\'ol},
		fromdutch        = {hollandb\'ol},
		fromenglish      = {angolb\'ol},
		fromestonian     = {\'esztb\H{o}l},
		fromfinnish      = {finnb\H{o}l},
		fromfrench       = {franci\'ab\'ol},
		fromgalician     = {gal\'iciaib\'ol},
		fromgerman       = {n\'emetb\H{o}l},
		fromgreek        = {g\"or\"ogb\H{o}l},
		fromitalian      = {olaszb\'ol},
		fromjapanese     = {jap\'anb\'ol},
		fromlatin        = {latinb\'ol},
		fromlatvian      = {lettb\H{o}l},
		fromnorwegian    = {norv\'egb\'ol},
		frompolish       = {lengyelb\H{o}l},
		fromportuguese   = {portug\'alb\'ol},
		fromrussian      = {oroszb\'ol},
		fromslovak       = {szlov\'akb\'ol},
		fromslovene      = {szlov\'enb\'ol},
		fromspanish      = {spanyolb\'ol},
		fromswedish      = {sv\'edb\H{o}l},
		fromukrainian    = {ukr\'anb\'ol},
		countryde        = {N\'emetorsz\'ag},
		countryep        = {Eur\'opai Uni\'o},
		countryeu        = {Eur\'opai Uni\'o},
		countryfr        = {Franciaorsz\'ag},
		countryuk        = {Egyes\"ult Kir\'alys\'ag},
		countryus        = {Amerikai Egyes\"ult \'Allamok},
		patent           = {szabadalom},
		patentde         = {n\'emet szabadalom},
		patenteu         = {eur\'opai szabadalom},
		patentfr         = {francia szabadalom},
		patentuk         = {brit szabadalom},
		patentus         = {amerikai szabadalom},
		patreq           = {szabadalmi k\'erelem},
		patreqde         = {n\'emet szabadalmi k\'erelem},
		patreqeu         = {eur\'opai szabadalmi k\'erelem},
		patreqfr         = {francia szabadalmi k\'erelem},
		patrequk         = {brit szabadalmi k\'erelem},
		patrequs         = {amerikai szabadalmi k\'erelem},
		file             = {f\'ajl},
		library          = {k\"onyvt\'ar},
		abstract         = {kivonat},
		annotation       = {jegyzet},
		commonera        = {id\H{o}sz\'am\'it\'asunk szerint},
		beforecommonera  = {id\H{o}sz\'am\'it\'asunk el\H{o}tt},
		annodomini       = {Krisztus ut\'an},
		beforechrist     = {Krisztus el\H{o}tt},
		circa            = {k\"or\"ulbel\"ul},
		spring           = {tavasz},
		summer           = {ny\'ar},
		autumn           = {\H{o}sz},
		winter           = {t\'el},
		am               = {d\'elel\H{o}tt},
		pm               = {d\'elut\'an},
}